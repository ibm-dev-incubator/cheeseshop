dist: trusty
language: python
python:
  - "3.5"
  - "3.6"
services:
  - postgresql

notifications:
  email: false

before_install:
  - psql -c 'create user cheeseshop;' -U postgres
  - psql -c 'ALTER USER cheeseshop CREATEDB;' -U postgres

install:
  - sudo apt-get install libprotobuf-dev protobuf-compiler
  - protoc -I /usr/include -I cheeseshop/demoparser/protobufs/src/ --python_out=cheeseshop/demoparser/protobufs/ cheeseshop/demoparser/protobufs/src/*.proto
  - pip install -U tox setuptools pbr
  - pip install -r requirements.txt
  - pip install -r test-requirements.txt
  - pip install .

jobs:
  include:
    - stage: lint
      script: tox -e lint

script: tox -e $(echo py$TRAVIS_PYTHON_VERSION | tr -d .)
